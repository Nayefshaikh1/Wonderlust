<% layout("/layouts/boilerplate") %>

    <body>

        <!-- <h3>All Listings</h3> -->
        <!-- <form action="/listings/new" method="get">
        <button>Create New Listing</button>
    </form> -->
        <style>
  /* Base styles */
  #filters {
    display:flex;
    align-items:center;
    gap:1rem;
    padding:1rem 0;
    overflow:visible;
    align-items:center;
  }

  .filter {
    flex:0 0 auto;
    text-align:center;
    transition: opacity .15s, transform .15s;
    white-space:nowrap;
    opacity: 0.7;
  }
    .filter:hover {
        opacity: 1;
    }
    .filter p {
        margin:0;
        font-size:0.9rem;
    }
  .filter.hidden-by-js {
    opacity:0;
    transform:scale(.95);
    pointer-events:none;
    width:0 !important;
    margin:0 !important;
    padding:0 !important;
    overflow:hidden;
  }

  /* tax switch pinned to right */
  .tax-switch { margin-left:auto; flex:0 0 auto; white-space:nowrap; }
  .tax-info{
               display: none;
            }
</style>

<div id="filters">
  <div class="filter"> <i class="fa-solid fa-fire"></i><p>Trending</p> </div>
  <div class="filter"> <i class="fa-solid fa-moon"></i><p>Nightlife</p> </div>
  <div class="filter"> <i class="fa-solid fa-tree"></i><p>Outdoors</p> </div>
  <div class="filter"> <i class="fa-solid fa-city"></i><p>Cityscapes</p> </div>
  <div class="filter"> <i class="fa-solid fa-water"></i><p>Beaches</p> </div>
  <div class="filter"> <i class="fa-solid fa-mountain"></i><p>Mountains</p> </div>
  <div class="filter"> <i class="fa-solid fa-snowflake"></i><p>Skiing</p> </div>
  <div class="filter"> <i class="fa-solid fa-umbrella-beach"></i><p>Tropical</p> </div>
  <div class="filter"> <i class="fa-solid fa-campground"></i><p>Camping</p> </div>
  <div class="filter"> <i class="fa-solid fa-landmark"></i><p>Historical</p> </div>
  <div class="filter"> <i class="fa-solid fa-ship"></i><p>Cruises</p> </div>
  <div class="filter"> <i class="fa-solid fa-hotel"></i><p>Resorts</p> </div>

  <div class="tax-switch">
    <div class="form-check form-switch form-check-reverse">
      <input class="form-check-input" type="checkbox" id="switchCheckDefault">
      <label class="form-check-label" for="switchCheckDefault">Display after total taxes</label>
    </div>
  </div>
</div>


        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 row-cols-esm-1 mt-3">
            <%for(let listing of allListings){%>
                <a href="/listings/<%= listing._id %>" class="listing-link">
                    <div class=" card listing-card col">
                        <img src="<%= listing.image.url%>" class="card-img-top" alt="listing_image"
                            style="height: 20rem;" />
                        <div class="card-img-overlay"></div>
                        <div class="card-body">
                            <p class="card-text">
                                <b>
                                    <%= listing.title %>
                                </b><br>
                                &#8377;<%= Number(listing.price).toLocaleString("en-IN") %> /night
                                <i class="tax-info"> &nbsp; &nbsp +18% GST</i>
                            </p>
                        </div>
                    </div>
                </a>

                <%}%>
        </div>

        

        <!-- <ul>
        <%for(let listing of allListings){%>
    <li> <a href="/listings/<%= listing._id %>"><%= listing.title %></a></li>
<%}%>
    </ul> -->

    
<script>
  (function(){
    const container = document.getElementById('filters');
    const tax = container.querySelector('.tax-switch');
    const filters = Array.from(container.querySelectorAll('.filter'));

    // debounce helper
    function debounce(fn, wait = 80){
      let t;
      return (...a)=>{ clearTimeout(t); t = setTimeout(()=>fn(...a), wait); };
    }

    // compute widths (including margins)
    function outerWidth(el){
      const style = window.getComputedStyle(el);
      const w = el.getBoundingClientRect().width;
      const ml = parseFloat(style.marginLeft || 0);
      const mr = parseFloat(style.marginRight || 0);
      return w + ml + mr;
    }

    function fitFilters(){
      // available space = container width minus tax-switch width minus small buffer
      const containerWidth = container.getBoundingClientRect().width;
      const taxWidth = tax ? outerWidth(tax) : 0;
      const buffer = 8; // small breathing room
      let available = containerWidth - taxWidth - buffer;

      // reveal all first so we can measure sum
      filters.forEach(f => f.classList.remove('hidden-by-js'));

      // compute total filters width
      let total = filters.reduce((s, f) => s + outerWidth(f), 0);

      // if total fits, done
      if (total <= available) return;

      // hide last visible filters until total fits
      for (let i = filters.length - 1; i >= 0; i--) {
        const f = filters[i];
        if (f.classList.contains('hidden-by-js')) continue; // already hidden
        f.classList.add('hidden-by-js');
        total -= outerWidth(f);
        if (total <= available) break;
      }
    }

    // when expanding, try to unhide in FIFO order (first hidden becomes visible if fits)
    function restoreFilters(){
      const containerWidth = container.getBoundingClientRect().width;
      const taxWidth = tax ? outerWidth(tax) : 0;
      let available = containerWidth - taxWidth - 8;

      let total = filters.reduce((s, f) => s + (f.classList.contains('hidden-by-js') ? 0 : outerWidth(f)), 0);

      for (let i = 0; i < filters.length; i++){
        const f = filters[i];
        if (!f.classList.contains('hidden-by-js')) continue;
        const w = outerWidth(f);
        if (total + w <= available){
          f.classList.remove('hidden-by-js');
          total += w;
        } else break;
      }
    }

    // unified handler
    const onResize = debounce(() => {
      // first reveal as many as possible
      restoreFilters();
      // then if still overflow, hide from end
      fitFilters();
    }, 80);

    // run once after fonts/icons load
    window.addEventListener('load', onResize);
    window.addEventListener('resize', onResize);
    // if your layout changes dynamically, you can call onResize() when content changes
  })();

            let taxSwitch = document.getElementById('switchCheckDefault');
            taxSwitch.addEventListener('click', () => {
                let taxInfoElements = document.getElementsByClassName('tax-info');
                if (taxSwitch.checked) {
                    for (let elem of taxInfoElements) {
                        elem.style.display = 'inline';
                    }
                } else {
                    for (let elem of taxInfoElements) {
                        elem.style.display = 'none';
                    }
                }
            });
        </script>
    </body>